#!/usr/bin/env python
import json
import click
import logging

from datums_warehouse.broker.warehouse import Warehouse


@click.command()
@click.argument('config', type=click.File('r'))
def update_warehouse(config):
    """Update the warehouse and its packets specified in the given config file"""
    logging.basicConfig(level=logging.INFO)
    logging.info("starting...")
    cfg = json.load(config)
    with open(cfg['WAREHOUSE'], mode='r') as wc:
        warehouse = Warehouse(json.load(wc))
    pairs = cfg['PAIRS']
    pairs = warehouse.all_packets() if pairs == "ALL" else pairs
    for p in pairs:
        warehouse.update(p)


if __name__ == "__main__":
    update_warehouse()
